<section class="encabezado">
  <div class="encabezado-logos">
    <img ngSrc="/assets/Captura.PNG" width="619" height="241" alt="#" class="encabezado-logos-img">
  </div>
  <div class="encabezado-buscar">
    <form [formGroup]="buscarForm" class="encabezado-buscar-formulario">
      <div class="campo-donde">
        <select id="Distrito" formControlName="Distrito" required>
          <option value="" disabled selected>Seleccione el distrito</option>
          @for (c of distrito; track c.id) {
            <option [value]="c.id">{{ c.nombre }}</option>
          }
        </select>
      </div>
      <div class="campo-aforo">
        <input id="Aforo" formControlName="Aforo" type="number" required>
        <label for="Aforo">Aforo</label>
      </div>
      <div class="campo-fecha">
        <input id="Fecha" formControlName="Fecha" type="date" required>
        <label for="Fecha">Fecha</label>
        <div class="campo-fecha-buscar" [class.invalido]="buscarForm.invalid">
          <a href="#">
            <button type="submit" [disabled]="buscarForm.invalid" (click)="buscar()"><img ngSrc="/assets/search-13-xxl%201.png" width="22" height="22" class="buscar-img" [class.invalido]="buscarForm.invalid"></button>
          </a>
        </div>
      </div>
    </form>
    <div class="encabezado-buscar-avanzada" [class.activo]="mostrarFiltrosAvanzados">
      <div class="encabezado-buscar-avanzada-container">
        <img ngSrc="/assets/icon.png" width="28" height="28" class="buscar-avanzada-img" (click)="toggleFiltrosAvanzados();">
      </div>
    </div>
  </div>
  <div class="overlay-buscar-avanzada" [class.activo]="mostrarFiltrosAvanzados" (click)="cerrarFiltrosAvanzados()">
    @if (mostrarFiltrosAvanzados){
      <form [formGroup]="buscarAvanzadaForm" class="encabezado-buscar-avanzada-cuadro" (click)="$event.stopPropagation()">
        <div class="encabezado-buscar-avanzada-cuadro-inicio">
          <h3 class="encabezado-buscar-avanzada-cuadro-h3">Filtros Avanzados</h3>
          <img ngSrc="/assets/X.png" width="29" height="28" class="X" (click)="toggleFiltrosAvanzados()">
        </div>
        <div class="filtros-avanzados">
          <div class="filtros-avanzados-ubicacion">
            <div class="filtros-avanzados-ubicacion-1">
              <h3>Ubicación</h3>
              <img ngSrc="/assets/location_on.png" width="14" height="14">
            </div>
            <select id="UbicacionAvanzada" formControlName="UbicacionAvanzada" required>
              <option value="" disabled selected>Seleccione el distrito</option>
              @for (c of distrito; track c.id) {
                <option [value]="c.id">{{ c.nombre }}</option>
              }
            </select>
          </div>
          <div class="filtros-avanzados-tipoevento">
            <div class="filtros-avanzados-tipoevento-1">
              <h3>Tipo de evento</h3>
              <img ngSrc="/assets/icononpng.png" width="10" height="5">
            </div>
            <select id="TipoEventoAvanzada" formControlName="TipoEventoAvanzada" required>
              <option value="" disabled selected>Seleccione el tipo de evento</option>
              @for (c of tipoevento; track c.id) {
                <option [value]="c.id">{{ c.nombre }}</option>
              }
            </select>
          </div>
          <div class="filtros-avanzados-fechainicio">
            <div class="filtros-avanzados-fechainicio-1">
              <h3>Fecha inicio</h3>
              <img ngSrc="/assets/Icononcalendar1.png" width="15" height="16">
            </div>
            <input formControlName="FechaInicioAvanzada" type="date" required>
          </div>
          <div class="filtros-avanzados-fechafin">
            <div class="filtros-avanzados-fechafin-1">
              <h3>Fecha fin</h3>
              <img ngSrc="/assets/Icononcalendar2.png" width="15" height="16">
            </div>
            <input formControlName="FechaFinAvanzada" type="date" required>
          </div>
          <div class="filtros-avanzados-aforo">
            <div class="filtros-avanzados-aforo-1">
              <h3>Aforo Mínimo</h3>
              <img ngSrc="/assets/icononperson.png" width="12" height="12">
            </div>
            <input formControlName="AforoAvanzadaMin" type="number" required>
          </div>
          <div class="filtros-avanzados-aforo">
            <div class="filtros-avanzados-aforo-1">
              <h3>Aforo Máximo</h3>
              <img ngSrc="/assets/icononperson.png" width="12" height="12">
            </div>
            <input formControlName="AforoAvanzadaMax" type="number" required>
          </div>
          <div class="empujar">
            <div class="filtros-avanzados-presupuesto">
              <div class="filtros-avanzados-presupuesto-1">
                <h3>Presupuesto Mínimo</h3>
                <img ngSrc="/assets/Iconondolar.png" width="9" height="16">
              </div>
              <input formControlName="PresupuestoAvanzadaMin" type="number" required>
            </div>
            <div class="filtros-avanzados-presupuesto">
              <div class="filtros-avanzados-presupuesto-1">
                <h3>Presupuesto Máximo</h3>
                <img ngSrc="/assets/Iconondolar.png" width="9" height="16">
              </div>
              <input formControlName="PresupuestoAvanzadaMax" type="number" required>
            </div>
          </div>
        </div>
        <button type="submit" [disabled]="buscarAvanzadaForm.invalid" (click)="buscarAvanzada()" class="boton-buscar">Buscar</button>
      </form>
    }
  </div>
  <a class="encabezado-h3" [routerLink]="['/register-proveedor']">Conviertete en un proveedor</a>
  <div class="encabezado-perfil">
    <img [src]="anfitrion.foto" width="60" height="60">
    <div class="encabezado-perfil-container" (click)="toggleMenuPerfil()">
      <h3 class="encabezado-perfil-container-1">inicio de sesión como:</h3>
      <h3 class="encabezado-perfil-container-2">{{anfitrion.email}}</h3>
    </div>
    <div class="encabezado-perfil-menu" [class.activo]="menuPerfilActivo">
      <nav class="encabezado-perfil-menu-nav">
        <ul class="encabezado-perfil-menu-ul">
          <li><a class="Vermiperfil-a" [routerLink]="['/ver-mi-perfil', anfitrion.id, anfitrion.role?.name]">Ver mi perfil</a></li>
          <li><a class="CerrarSesion-a" (click)="abrirModalCerrarSesion()">Cerrar sesión</a></li>
        </ul>
      </nav>
    </div>
  </div>
</section>
<body>
<section class="menu-hamburguesa">
  <div class="menu-hamburguesa-boton" [class.desactivado]="mostrarFiltrosAvanzados" (click)="toggleMenu()">
    <img ngSrc="/assets/Menu.png" width="41" height="41" class="menu-hamburguesa-img">
  </div>
  <div class="overlay" [class.activo]="menuActivo"></div>
  <nav class="menu-hamburguesa-text">
    <ul class="menu-hamburguesa-text-1">
      <li><a class="EventosEnCurso" [routerLink]="['/eventos-curso', anfitrion.id]">Eventos en curso</a></li>
      <li><a class="HistorialDeEventos" [routerLink]="['/historial-eventos', anfitrion.id]">Historial de eventos</a></li>
      <li><a class="ChatearConLaIA" href="#">Chatear con la IA</a></li>
      <li><a class="CentroDeAyuda" [routerLink]="['/centro-ayuda', anfitrion.id, anfitrion.role?.name]">Centro de ayuda</a></li>
    </ul>
    <ul class="menu-hamburguesa-text-2">
      <li><a class="Configuracion" [routerLink]="['/configuracion', anfitrion.id, anfitrion.role?.name]">Configuración</a></li>
      <li><a class="CerrarSesion" (click)="abrirModalCerrarSesion()">Cerrar sesión</a></li>
      <li><a class="legal" [routerLink]="['/legal', anfitrion.id, anfitrion.role?.name]">Legal</a></li>
    </ul>
  </nav>
</section>
<section class="detalle-container">

  <div class="detalle-wrapper">

    <div class="detalle-header">
      <button class="btn-volver" (click)="volverAtras()">
        <img ngSrc="/assets/back.png" width="44" height="44" alt="Volver" [routerLink]="['/menu-anfitrion', anfitrion.id]">
      </button>
      <h1>Detalle de evento</h1>
    </div>

    <section class="carousel-container">

      <div class="carousel-track"
           [style.transform]="'translateX(-' + currentSlideIndex * slideWidthPercentage + '%)'">
        @for (img of imagenesEvento; track $index) {
          <div class="carousel-slide">
            <img [src]="img.imagen" width="800" height="600" alt="Foto del evento {{$index + 1}}">
          </div>
        }
      </div>

      <button class="carousel-btn prev"
              (click)="anteriorSlide()"
              [disabled]="currentSlideIndex === 0">
        &#9664;
      </button>
      <button class="carousel-btn next"
              (click)="siguienteSlide()"
              [disabled]="currentSlideIndex >= (imagenesEvento.length - itemsPorVista)">
        &#9654;
      </button>

      <div class="carousel-fade left"></div>
      <div class="carousel-fade right"></div>

    </section>

    <div class="detalle-contenido">

      <div class="columna-principal">
        <h2 class="titulo-evento">{{evento.titulo}}</h2>
        <p class="ubicacion-evento">{{evento.distrito.ciudad.nombre}}, {{evento.distrito.nombre}}</p>

        <div class="proveedor-info">
          <img [src]="'data:image/jpeg;base64,' + evento.proveedor.foto" width="50" height="50" class="proveedor-avatar">
          <div class="proveedor-detalles">
            <span class="label">Proveedor:</span>
            <span class="nombre">{{evento.proveedor.nombreorganizacion}}</span>
          </div>
          <div class="proveedor-rating">
            <span class="star-icon">&#9733;</span>
            <span class="rating-valor">{{evento.valoracion}}</span>
            <span class="rating-reviews">(23 Reseñas)</span>
          </div>
          <button class="chat-btn" aria-label="Chatear con proveedor">
            <img src="/assets/Message%20circle.png" width="24" height="24">
          </button>
        </div>

        <div class="descripcion-box">
          <label for="descripcion">Descripcion:</label>
          <div class="descripcion-texto" id="descripcion">
            {{evento.descripcion}}
          </div>
        </div>
      </div>

      <div class="columna-lateral">
        <div class="detalles-box">
          <div class="detalle-item">
            <span>Presupuesto:</span>
            <strong>{{evento.presupuesto}}</strong>
          </div>
          <div class="detalle-item">
            <span>Fecha de inicio:</span>
            <strong>{{evento.fechainicio}}</strong>
          </div>
          <div class="detalle-item">
            <span>Fecha de fin:</span>
            <strong>{{evento.fechafin}}</strong>
          </div>
          <div class="detalle-item">
            <span>Aforo:</span>
            <strong>{{evento.aforo}}</strong>
          </div>
          <div class="detalle-item">
            <span>Distrito:</span>
            <strong>{{evento.distrito.nombre}}</strong>
          </div>
        </div>
        @if (evento.estado == 'Disponible'){
          <button [routerLink]="['/reservar-evento', anfitrion.id, evento.id]" class="reservar-btn">Reservar</button>
        }
        @for (contratoevento of contratoEvento; track contratoevento){
          @if (contratoevento.evento.estado == 'En curso' && (contratoevento.anfitrion.id != anfitrion.id)){
            <button class="reservar-btn">La reserva no se encuentra disponible</button>
          } @else if (contratoevento.evento.estado == 'En curso' && (contratoevento.anfitrion.id == anfitrion.id)){
            <button [routerLink]="['/menu-anfitrion', anfitrion.id]" (click)="finalizarContrato(contratoevento.id!, contratoevento.anfitrion, contratoevento.evento, contratoevento.fechacontrato)" class="reservar-btn-finalizar">Finalizar contrato</button>
          }
        }
      </div>
    </div>
    <section class="proveedor-reglas-section">

      <aside class="columna-proveedor-card">
        <div class="perfil-header">
          <img [src]="'data:image/jpeg;base64,' + evento.proveedor.foto" width="100" height="100" alt="Foto de Marco Tapia López" class="perfil-avatar">
          <h3 class="perfil-nombre">{{evento.proveedor.nombreorganizacion}}</h3>
          <div class="perfil-stats">
            <div class="stat-item">
              <strong>27</strong>
              <span>Reseñas</span>
            </div>
            <div class="stat-item">
              <strong>{{evento.valoracion}}</strong>
              <span>Calificación</span>
            </div>
          </div>
        </div>

        <div class="perfil-contacto">
          <div class="contacto-item">
            <label>Email:</label>
            <span>{{evento.proveedor.email}}</span>
          </div>
          <div class="contacto-item">
            <label>Ruc:</label>
            <span>{{evento.proveedor.ruc}}</span>
          </div>
          <div class="contacto-item">
            <label>Teléfono:</label>
            <span>{{evento.proveedor.numerocontacto}}</span>
          </div>
        </div>

        <button class="contactar-btn">
          Contactar con proveedor
          <img src="/assets/Message%20circle.png" width="20" height="20" alt="Chat">
        </button>
      </aside>

      <article class="columna-reglas-card">
        <h2>Lo que debes saber</h2>

        <div class="reglas-seccion">
          <h3>Reglas de todos los eventos:</h3>
          <ul>
            <li>Coordinación: La coordinación de detalles finales se con al menos 1 semana de anticipación.</li>
            <li>Personalización: Cualquier ajuste al paquete debe coordinarse con al menos 1 semana de anticipación.</li>
          </ul>
        </div>

        <div class="reglas-seccion">
          <h3>Seguridad y logística</h3>
          <ul>
            <li>Localización: El evento se realiza en un local con monitoreo de seguridad.</li>
            <li>Medidas de seguridad: Extintores y señalización de emergencia en el local.</li>
            <li>Responsabilidad: No nos hacemos responsables por objetos personales perdidos.</li>
          </ul>
        </div>

        <div class="reglas-seccion">
          <h3>Política de cancelación</h3>
          <ul>
            <li>Cancelación anticipada: Si cancelas con 15 días o más de anticipación a la fecha del evento, recibirás un reembolso parcial del 50%.</li>
            <li>Cancelación tardía: Si cancelas con menos de 15 días, la reserva no será reembolsable.</li>
            <li>Cambio de fecha: Los cambios de fecha están sujetos a la disponibilidad del local y del proveedor.</li>
          </ul>
        </div>
      </article>

    </section>
    <section class="resenas">
      <div class="resenas-seccion">

        <div class="resenas-header">
          <h3 class="resenas-titulo">Comentarios y Valoraciones</h3>
          <span class="resenas-rating-global">{{evento.valoracion}} (125)</span>
            @for (resenaevento of resenaEvento; track resenaevento) {
              @if (resenaevento.anfitrion.id === anfitrion.id){
                <button (click)="eliminarResena(resenaevento.id!)" class="btn-eliminar-resenas">Eliminar su reseña</button>
              }
            }
          <button [routerLink]="['/edicion-resena', anfitrion.id, evento.id]" class="btn-mis-resenas">Publicar una reseña</button>
        </div>

        <div class="resena-list">
          @for (resenaevento of resenaEvento; track resenaevento) {
            <div class="resena-card">
              <img [src]="'data:image/jpeg;base64,' + resenaevento.anfitrion.foto" alt="Avatar de {{resenaevento.anfitrion.nombre}}" class="resena-avatar" width="50" height="50">
              <div class="resena-body">
                <div class="resena-card-header">
                  <span class="resena-nombre">{{resenaevento.anfitrion.nombre}}</span>
                  <div class="resena-estrellas">
                    @for (isFull of getStars(resenaevento.valoracion); track $index) {
                      @if (isFull) {
                        <span>⭐</span> } @else {
                        <span>☆</span> }
                    }
                    <span class="rating-numero">{{resenaevento.valoracion.toFixed(1)}}</span>
                  </div>
                </div>
                <p class="resena-comentario">{{resenaevento.observacion}}</p>
              </div>
            </div>
          }
        </div>
      </div>
    </section>
  </div>
</section>
  @if (mostrarCerrarSesion) {
    <section class="cerrar-sesion">
      <div class="overlay-cerrar-sesion"></div>
      <div class="cerrar-sesion-container" (click)="$event.stopPropagation()">
        <h1>Cerrar Sesión</h1>
        <h3>¿Estas seguro de cerrar tu sesión?</h3>
        <div class="cerrar-sesion-container-botones" (click)="cerrarSesion()">
          <button class="boton-si" (click)="confirmarCerrarSesion($event)"><a [routerLink]="['/']">Sí</a></button>
          <button class="boton-no" (click)="cancelarCerrarSesion($event)">No</button>
        </div>
      </div>
    </section>
  }

</body>
